<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä½¿ç”¨Pythonå®ç°è®¡ç®—åŸºå°¼æŒ‡æ•°ä¸æ³°å°”æŒ‡æ•° | Moxz Blog</title>
    <meta name="generator" content="VuePress 1.7.1">
    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?c838626f612a22725168e1a92aaa438c";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <meta name="description" content="
å‰é˜µå­å¥³ç¥¨è¢«è¦æ±‚è¦åœ¨äº”å¤©ä¹‹å†…å†™å®Œä¸€ç¯‡è®ºæ–‡ï¼Œè¿™äº‹æœ¬æ¥æŒºç¦»è°±çš„ï¼Œæ²¡æƒ³åˆ°æœ€åè¿˜çœŸç»™å®Œæˆäº†ï¼Œå…¶ä¸­çš„é‡å¤´æˆæ˜¯è¦åšå¹¿ä¸œçœå„åœ°åŒºçš„åŸºå°¼æŒ‡æ•°å’Œæ³°å°”æŒ‡æ•°åˆ†æï¼Œå› ä¸ºæ—¶é—´å¤ªèµ¶ï¼Œå¥¹æ¥ä¸åŠåˆ†ææ•°æ®ï¼Œåªå¥½ç”±æˆ‘è¿™ä¸ªç¨‹åºå‘˜æ¥ä»£åŠ³äº†ã€‚

è¿™äº‹å…¶å®æ˜¯æˆ‘è‡ªå‘Šå¥‹å‹‡çš„ï¼Œå½“å¹´è·Ÿç€Ngè€å¸ˆæ²¡å°‘å­¦ç”¨Pythonææœºå™¨å­¦ä¹ çš„çŸ¥è¯†ï¼Œç†é™¶äº†ä¸å°‘æ•°æ®å¤„ç†æ–¹é¢æ“ä½œçŸ©é˜µçš„æ€æƒ³ï¼Œæƒ³ç€æ­£å¥½åœ¨å¥³ç¥¨é¢å‰æ˜¾æ‘†æ˜¾æ‘†ã€‚æ²¡æƒ³åˆ°çœŸæ­£å†™ä»£ç çš„æ—¶å€™ï¼Œå› ä¸ºå¥½ä¹…æ²¡ç¢°Pythonï¼Œ ...">
    <meta name="baidu-site-verification" content="code-C8OyTS1FAY">
    
    <link rel="preload" href="/assets/css/0.styles.69e31e73.css" as="style"><link rel="preload" href="/assets/js/app.d2f1f4ee.js" as="script"><link rel="preload" href="/assets/js/6.86baad8d.js" as="script"><link rel="preload" href="/assets/js/12.d5b0440f.js" as="script"><link rel="preload" href="/assets/js/14.bed357be.js" as="script"><link rel="prefetch" href="/assets/js/10.5a75828b.js"><link rel="prefetch" href="/assets/js/11.e4e5bb84.js"><link rel="prefetch" href="/assets/js/13.a19b6f49.js"><link rel="prefetch" href="/assets/js/15.7a4e1b49.js"><link rel="prefetch" href="/assets/js/3.53b9d3bd.js"><link rel="prefetch" href="/assets/js/4.b0b7d7b9.js"><link rel="prefetch" href="/assets/js/5.eaea3094.js"><link rel="prefetch" href="/assets/js/7.b781aead.js"><link rel="prefetch" href="/assets/js/8.c8345aee.js"><link rel="prefetch" href="/assets/js/9.6f8bf260.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.a1ad9120.js">
    <link rel="stylesheet" href="/assets/css/0.styles.69e31e73.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">Moxz Blog </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">Moxz Blog </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div><div class="content__default"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="header-anchor">#</a> å‰è¨€</h2> <p>å‰é˜µå­å¥³ç¥¨è¢«è¦æ±‚è¦åœ¨äº”å¤©ä¹‹å†…å†™å®Œä¸€ç¯‡è®ºæ–‡ï¼Œè¿™äº‹æœ¬æ¥æŒºç¦»è°±çš„ï¼Œæ²¡æƒ³åˆ°æœ€åè¿˜çœŸç»™å®Œæˆäº†ï¼Œå…¶ä¸­çš„é‡å¤´æˆæ˜¯è¦åšå¹¿ä¸œçœå„åœ°åŒºçš„åŸºå°¼æŒ‡æ•°å’Œæ³°å°”æŒ‡æ•°åˆ†æï¼Œå› ä¸ºæ—¶é—´å¤ªèµ¶ï¼Œå¥¹æ¥ä¸åŠåˆ†ææ•°æ®ï¼Œåªå¥½ç”±æˆ‘è¿™ä¸ªç¨‹åºå‘˜æ¥ä»£åŠ³äº†ã€‚</p> <p>è¿™äº‹å…¶å®æ˜¯æˆ‘è‡ªå‘Šå¥‹å‹‡çš„ï¼Œå½“å¹´è·Ÿç€Ngè€å¸ˆæ²¡å°‘å­¦ç”¨Pythonææœºå™¨å­¦ä¹ çš„çŸ¥è¯†ï¼Œç†é™¶äº†ä¸å°‘æ•°æ®å¤„ç†æ–¹é¢æ“ä½œçŸ©é˜µçš„æ€æƒ³ï¼Œæƒ³ç€æ­£å¥½åœ¨å¥³ç¥¨é¢å‰æ˜¾æ‘†æ˜¾æ‘†ã€‚æ²¡æƒ³åˆ°çœŸæ­£å†™ä»£ç çš„æ—¶å€™ï¼Œå› ä¸ºå¥½ä¹…æ²¡ç¢°Pythonï¼Œè¯­æ³•å¿˜çš„éƒ½å·®ä¸å¤šäº†ï¼Œå†™èµ·æ¥ç£•ç£•ç»Šç»Šï¼Œè¾¹åœ¨ç½‘ä¸ŠæŸ¥pandaså’Œnumpyçš„ç”¨æ³•ï¼Œè¾¹å†™ä»£ç ï¼Œä¸‡å¹¸æœ€åæ²¡æ‰é“¾å­ï¼Œç”¨äº†å‘¨æœ«ä¸¤å¤©æ—¶é—´æŒ‰æ—¶å®Œæˆäº†ä»»åŠ¡ã€‚</p> <h2 id="åŸºå°¼æŒ‡æ•°"><a href="#åŸºå°¼æŒ‡æ•°" class="header-anchor">#</a> åŸºå°¼æŒ‡æ•°</h2> <p>è¯ä¸å¤šè¯´ï¼Œå…ˆæ¥è¯´è¯´åŸºå°¼æŒ‡æ•°ï¼Œç”¨æ¥æ ‡å¿—æ”¶å…¥æ°´å¹³è´«å¯Œå·®è·çš„ï¼ŒèŒƒå›´æ˜¯[0, 1]ï¼Œè¶Šæ¥è¿‘1ï¼Œè´«å¯Œå·®è·è¶Šå¤§ï¼Œ0.4æ˜¯é¢„è­¦å€¼ï¼Œè¶…è¿‡äº†åŸºæœ¬å°±æ˜¯è´«å¯Œå·®è·å¤§äº†ã€‚æ‰¾äº†ä¸‹æˆ‘å›½çš„åŸºå°¼æŒ‡æ•°ï¼Œè²Œä¼¼æ²¡æœ‰è¿‘å‡ å¹´çš„ï¼Œæœ‰ä¸€ä¸ªè¥¿å—è´¢ç»å¤§å­¦ç»Ÿè®¡çš„ï¼Œ2015å¹´æˆ‘å›½çš„åŸºå°¼æŒ‡æ•°æ˜¯0.62ï¼Œè¿™ä¸ªå€¼çœ‹çœ‹å°±å¥½ï¼ŒæŒºå“äººçš„ã€‚</p> <p>å½“ç„¶äº†ï¼ŒåŸºå°¼æŒ‡æ•°ä¸æ­¢å¯ä»¥ç®—è´«å¯Œå·®è·ï¼Œè¿˜å¯ä»¥è®¡ç®—æŸä¸€èµ„æºåœ¨æŸä¸€åœ°åŒºçš„åˆ†é…æ˜¯å¦åˆç†ï¼Œç”¨é€”è¿˜æ˜¯æŒºå¹¿æ³›çš„ã€‚å…¶å…¬å¼å¦‚ä¸‹ï¼š</p> <center><p>$G=\sum_{i=1}^{n}\left({ X_{i}Y_{i} } \right) + 2\sum_{i=1}^{n-1}\left({ X_{i}(1 - V_{i}) } \right) - 1$</p></center> <p>$X_{i}$ä¸ºå„å¸‚åŒºäººå£æ•°(æˆ–é¢ç§¯æ•°)å æ€»äººå£(æˆ–é¢ç§¯)çš„æ¯”é‡;$Y_{i}$ä¸ºæŸèµ„æºæŒ‡æ ‡æ•°å€¼å ç›¸åº”è¯¥èµ„æºæŒ‡æ ‡æ€»æ•°çš„æ¯”é‡;$V_{i}$ä¸ºè¯¥èµ„æºå æœ‰é‡<strong>æ’åºå</strong>çš„ç´¯ç§¯ç™¾åˆ†æ¯”ã€‚</p> <p>å…¶å®è¿™ä¸ªè¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œç›´æ¥ä¸Šä»£ç å•¦ã€‚</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># cal_gini.py</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.unicode.ambiguous_as_wide'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.unicode.east_asian_width'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.width'</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">cal_gini</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
  data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">&quot;gbk&quot;</span><span class="token punctuation">)</span>
  data<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
  data<span class="token punctuation">[</span><span class="token string">'Y'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
  data<span class="token punctuation">[</span><span class="token string">'V'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
  data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  data <span class="token operator">=</span> data<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span>y<span class="token punctuation">)</span>
  col1 <span class="token operator">=</span> data<span class="token punctuation">[</span>x<span class="token punctuation">]</span>
  col2 <span class="token operator">=</span> data<span class="token punctuation">[</span>y<span class="token punctuation">]</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n1.æŒ‰&quot;</span> <span class="token operator">+</span> y <span class="token operator">+</span> <span class="token string">&quot;æ’åº:\n&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
  <span class="token keyword">for</span> index<span class="token punctuation">,</span> e <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>col1<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> e <span class="token operator">/</span> col1<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n2.è®¡ç®— Xi:\n&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
  <span class="token keyword">for</span> index<span class="token punctuation">,</span> e <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>col2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> e <span class="token operator">/</span> col2<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n3.è®¡ç®— Yi:\n&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
  data<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'tmp.csv'</span><span class="token punctuation">)</span>
  data<span class="token punctuation">[</span><span class="token string">'V'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span><span class="token punctuation">)</span>
  data <span class="token operator">=</span> data<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>labels<span class="token operator">=</span><span class="token string">'SUM'</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\n4.è®¡ç®— Vi:\n&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
  gini <span class="token operator">=</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span> <span class="token operator">*</span> data<span class="token punctuation">[</span><span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> data<span class="token punctuation">[</span><span class="token string">'V'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> data<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token keyword">return</span> gini
<span class="token punctuation">}</span>
</code></pre></div><p>å…¶å®æœ€ä¸»è¦çš„é€»è¾‘å°±æ˜¯åœ¨dataFrameååŠ Xï¼ŒYä¸¤åˆ—ï¼Œåˆ†åˆ«è®¡ç®—å‡ºæ¥åï¼ŒæŒ‰ç…§Yæ’åºï¼Œç„¶åè®¡ç®—å‡ºVï¼Œæœ€åæ ¹æ®ä¸Šé¢çš„å…¬å¼å°±å¯ä»¥ç®—å‡ºæ¥åŸºå°¼æŒ‡æ•°å•¦ã€‚å…¶ä¸­æŒºé‡è¦çš„ä¸€ä¸ªç‚¹æ˜¯å¼ºå¤§çš„pandasæä¾›äº†dcumsum()æ–¹æ³•ï¼Œç›´æ¥å°±å¯ä»¥è®¡ç®—å‡ºç´¯åŠ å€¼ï¼Œç‚¹èµğŸ‘ã€‚å¦å¤–æˆ‘æ˜¯æŒ‰ç…§å¹´ä»½æ¥åˆ†çš„csvï¼Œå‡ å¹´å°±å‡ ä¸ªcsvï¼Œä¸€ä¸ªä¸€ä¸ªcsvåˆ†åˆ«è¯»å–ç„¶åè®¡ç®—å„å¹´ä»½çš„åŸºå°¼æŒ‡æ•°ã€‚</p> <p>csvæ–‡ä»¶åæ ¼å¼ä¸ºgini_ori_<em>[year]</em>.csvï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p> <table><thead><tr><th>åŸå¸‚</th> <th>èµ„æº1</th> <th>èµ„æº2</th> <th>èµ„æºn</th> <th>äººå£</th> <th>é¢ç§¯</th></tr></thead> <tbody><tr><td>åŸå¸‚1</td> <td>1000</td> <td>100</td> <td>10</td> <td>3000</td> <td>200</td></tr> <tr><td>åŸå¸‚2</td> <td>2000</td> <td>200</td> <td>20</td> <td>4000</td> <td>300</td></tr> <tr><td>åŸå¸‚3</td> <td>3000</td> <td>300</td> <td>30</td> <td>5000</td> <td>400</td></tr></tbody></table> <p>è°ƒç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># main.py</span>
<span class="token keyword">import</span> cal_gini <span class="token keyword">as</span> cg
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> os

pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.unicode.ambiguous_as_wide'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.unicode.east_asian_width'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.width'</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>

x_arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'äººå£'</span><span class="token punctuation">,</span> <span class="token string">'é¢ç§¯'</span><span class="token punctuation">]</span>
y_arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'èµ„æº1'</span><span class="token punctuation">,</span> <span class="token string">'èµ„æº2'</span><span class="token punctuation">,</span> <span class="token string">'èµ„æº3'</span><span class="token punctuation">]</span>
years <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'2015'</span><span class="token punctuation">,</span> <span class="token string">'2016'</span><span class="token punctuation">,</span> <span class="token string">'2017'</span><span class="token punctuation">,</span> <span class="token string">'2018'</span><span class="token punctuation">,</span> <span class="token string">'2019'</span><span class="token punctuation">]</span>  

<span class="token comment"># result wrapper</span>
inner_result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>years<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>y_arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>x_arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>inner_result<span class="token punctuation">)</span>

<span class="token keyword">for</span> x_idx<span class="token punctuation">,</span> x_e <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>x_arr<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">for</span> y_idx<span class="token punctuation">,</span> y_e <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>y_arr<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> years_idx<span class="token punctuation">,</span> years_e <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>years<span class="token punctuation">)</span><span class="token punctuation">:</span>
      inner_result<span class="token punctuation">[</span>x_idx<span class="token punctuation">]</span><span class="token punctuation">[</span>y_idx<span class="token punctuation">]</span><span class="token punctuation">[</span>years_idx<span class="token punctuation">]</span> <span class="token operator">=</span> cg<span class="token punctuation">.</span>cal_gini<span class="token punctuation">(</span><span class="token string">'pandas/gini/data/gini_ori_'</span> <span class="token operator">+</span> years_e <span class="token operator">+</span> <span class="token string">'.csv'</span><span class="token punctuation">,</span> x_e<span class="token punctuation">,</span> y_e<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'='</span> <span class="token operator">*</span> <span class="token number">40</span> <span class="token operator">+</span> <span class="token string">&quot; RESULT BEGIN &quot;</span> <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">*</span> <span class="token number">40</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span> 
<span class="token keyword">for</span> x_idx<span class="token punctuation">,</span> x_e <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>x_arr<span class="token punctuation">)</span><span class="token punctuation">:</span> 
  <span class="token keyword">print</span><span class="token punctuation">(</span>x_e<span class="token punctuation">)</span>
  r <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>inner_result<span class="token punctuation">[</span>x_idx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T
  r<span class="token punctuation">.</span>columns <span class="token operator">=</span> y_arr
  r<span class="token punctuation">.</span>index <span class="token operator">=</span> years
  <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'='</span> <span class="token operator">*</span> <span class="token number">40</span> <span class="token operator">+</span> <span class="token string">&quot; RESULT END &quot;</span> <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">*</span> <span class="token number">40</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span> 
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>inner_result<span class="token punctuation">)</span><span class="token punctuation">)</span> 
</code></pre></div><h2 id="æ³°å°”æŒ‡æ•°"><a href="#æ³°å°”æŒ‡æ•°" class="header-anchor">#</a> æ³°å°”æŒ‡æ•°</h2> <p>æ³°å°”æŒ‡æ•°æ¯”åŸºå°¼æŒ‡æ•°ç¨å¾®å¤æ‚ä¸€äº›ï¼Œä¹Ÿæ˜¯ç”¨æ¥åˆ†æèµ„æºåˆ†é…å·®å¼‚çš„ï¼Œä½†æ˜¯æ³°å°”æŒ‡æ•°æ¯”åŸºå°¼æŒ‡æ•°å¤šäº†ä¸€ä¸ªå¯¹åŸå§‹æ•°æ®åˆ†ç»„ã€‚æ¯”å¦‚ï¼šå¹¿å·ï¼Œæ·±åœ³éƒ½å±äºç ä¸‰è§’ç»„ï¼Œæ±•å¤´ï¼ŒéŸ¶å…³å±äºç²¤åŒ—ç»„ç­‰ç­‰ã€‚è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥ä»¥ç»„ä¸ºå•ä½ï¼Œè®¡ç®—å‡ºç»„é—´æ³°å°”æŒ‡æ•°å’Œç»„å†…æ³°å°”æŒ‡æ•°ï¼›ç„¶åæ ¹æ®ç»„é—´ç»„å†…è´¡çŒ®ç‡æ›´æœ‰æ•ˆçš„åˆ†æå„åŒºåŸŸé—´çš„åˆ†é…å·®å¼‚ã€‚å…¶å…¬å¼å¦‚ä¸‹ï¼š</p> <center><p>$T=\sum_{i=1}^{n}\left({ R_{i}\log(R_{i} / W_{i}) } \right)$</p></center> <p>$R_{i}$è¡¨ç¤ºå„å¸‚åŒºäººå‡èµ„æºå æœ‰é‡å å…¨éƒ¨èµ„æºçš„æ¯”ä¾‹ï¼Œ$W_{i}$è¡¨ç¤ºå„å¸‚åŒºäººå£æ•°å äººå£æ€»æ•°æ¯”ä¾‹ã€‚</p> <p>è¿ç”¨æ³°å°”æŒ‡æ•°å°†å·®å¼‚è¿›è¡Œåˆ†è§£ä¸º: <font size="4"><em>T</em></font><font size="1">æ€»</font> = <font size="4"><em>T</em></font><font size="1">å†…</font> + <font size="4"><em>T</em></font><font size="1">é—´</font></p> <p>ç»„å†…æ³°å°”æŒ‡æ•°ä¸º: <font size="4"><em>T</em></font><font size="1">å†…</font> = $\sum_{j=1}^{m}\left({ r_{i}T_{i} } \right)$</p> <p>ç»„é—´æ³°å°”æŒ‡æ•°ä¸º: <font size="4"><em>T</em></font><font size="1">é—´</font> = $\sum_{j=1}^{m}\left({ r_{i}\log(r_{i} / w_{i}) } \right)$</p> <p>å…¶ä¸­$r_{j}$ï¼Œ$w_{j}$åˆ†åˆ«è¡¨ç¤ºå„ç»„äººå‡èµ„æºå æœ‰é‡å å…¨éƒ¨èµ„æºçš„æ¯”é‡ã€å„ç»„äººå£æ•°å äººå£æ€»æ•°æ¯”ä¾‹ã€‚</p> <p><strong>PS:</strong><br> <strong>è¿™é‡Œè¦æ³¨æ„çš„ä¸€ä¸ªç‚¹æ˜¯è®¡ç®—$r_{j}$ï¼Œ$w_{j}$æ—¶ï¼Œåˆ†æ¯æ˜¯å½“å‰åˆ†ç»„çš„å…¨éƒ¨èµ„æºï¼Œä¸æ˜¯æ•´ä¸ªçœä»½çš„å…¨éƒ¨èµ„æºï¼Œå½“æ—¶ç®—å‡ºæ¥çš„ä¸€ç›´æ˜¯è´Ÿæ•°ï¼Œæ•´æ•´æµªè´¹äº†åŠå¤©æ—¶é—´æ¥æ‰¾ç¨‹åºçš„é—®é¢˜ï¼Œä¹‹åå¥³ç¥¨å’¨è¯¢äº†ç»Ÿè®¡ä¸“ä¸šçš„ç«¥é‹æ‰å‘ç°ï¼ŒåŸæ¥æ˜¯æˆ‘å¯¹å…¬å¼çš„ç†è§£é”™äº†ğŸ¤¯ã€‚</strong></p> <p>ç”±äºæ³°å°”æŒ‡æ•°æ¶‰åŠå¯¹æ•°æ®åˆ†ç»„ï¼Œè¿˜è¦è®¡ç®—ç»„å†…ç»„é—´ï¼Œå†åŠ ä¸Šè¿˜è¦åˆ†æå„å¹´ä»½çš„æ•°æ®ï¼Œä»£ç æ¯”è¾ƒç¹çï¼Œä½†æ˜¯å…¶å®å®ç°é€»è¾‘è¿˜æ˜¯å¾ˆç®€å•çš„ï¼š</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># cal_theil.py</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> math

<span class="token keyword">global</span> data_total
<span class="token keyword">global</span> area_arr
<span class="token keyword">global</span> years

pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.unicode.ambiguous_as_wide'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.unicode.east_asian_width'</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>set_option<span class="token punctuation">(</span><span class="token string">'display.width'</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span>

area_arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'åŒºåŸŸ1'</span><span class="token punctuation">,</span> <span class="token string">'åŒºåŸŸ2'</span><span class="token punctuation">,</span> <span class="token string">'åŒºåŸŸ3'</span><span class="token punctuation">,</span> <span class="token string">'åŒºåŸŸ4'</span><span class="token punctuation">]</span>
years <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'2015'</span><span class="token punctuation">,</span> <span class="token string">'2016'</span><span class="token punctuation">,</span> <span class="token string">'2017'</span><span class="token punctuation">,</span> <span class="token string">'2018'</span><span class="token punctuation">,</span> <span class="token string">'2019'</span><span class="token punctuation">]</span>
y_arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'èµ„æº1'</span><span class="token punctuation">,</span> <span class="token string">'èµ„æº2'</span><span class="token punctuation">,</span> <span class="token string">'èµ„æº3'</span><span class="token punctuation">]</span>

data_total <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'pandas/theil/data/theil_ori_2019.csv'</span><span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">&quot;gbk&quot;</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'pandas/theil/data/theil_ori_2019.csv'</span><span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">&quot;gbk&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'1.è·å–åŸå§‹æ•°æ®: \n'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>

<span class="token comment"># è®¡ç®—æ³°å°”æŒ‡æ•°</span>
<span class="token keyword">def</span> <span class="token function">cal_theil</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> p<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
  data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  data<span class="token punctuation">[</span><span class="token string">'åŒºåŸŸ'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'SUM'</span>
  data<span class="token punctuation">[</span><span class="token string">'åŸå¸‚'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'SUM'</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span>
  data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">'Y'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">/</span> data<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span>
  data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">'P'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">/</span> data<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span>
  data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">'T'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'P'</span><span class="token punctuation">]</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'P'</span><span class="token punctuation">]</span> <span class="token operator">/</span> data<span class="token punctuation">[</span><span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token comment"># data.replace(np.inf, 0) # æ›¿æ¢infä¸º0</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token string">'æ³°å‹’æŒ‡æ•°: '</span><span class="token punctuation">,</span>  data<span class="token punctuation">[</span><span class="token string">'T'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> data<span class="token punctuation">[</span><span class="token string">'T'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># è®¡ç®—å„å¹´ä»½çœä»½æ³°å°”æŒ‡æ•°</span>
<span class="token keyword">def</span> <span class="token function">cal_year_theil</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> y<span class="token punctuation">,</span> years<span class="token punctuation">)</span><span class="token punctuation">:</span>
  result_year_theil <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>years<span class="token punctuation">)</span>
  <span class="token keyword">for</span> idx<span class="token punctuation">,</span> e <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>years<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'pandas/theil/data/theil_ori_'</span> <span class="token operator">+</span> e <span class="token operator">+</span> <span class="token string">'.csv'</span><span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">&quot;gbk&quot;</span><span class="token punctuation">)</span>
    result_theil_arr <span class="token operator">=</span> cal_theil<span class="token punctuation">(</span>data<span class="token punctuation">,</span> p<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
    result_year_theil<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> result_theil_arr
  <span class="token keyword">return</span> result_year_theil

<span class="token comment"># ç»„å†…</span>
<span class="token keyword">def</span> <span class="token function">cal_in</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> p<span class="token punctuation">,</span> y<span class="token punctuation">,</span> area<span class="token punctuation">)</span><span class="token punctuation">:</span>
  theil_g <span class="token operator">=</span> cal_area_theil<span class="token punctuation">(</span>data<span class="token punctuation">,</span> p<span class="token punctuation">,</span> y<span class="token punctuation">,</span> area<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>theil_g<span class="token punctuation">)</span>
  result_in <span class="token operator">=</span>  <span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'P'</span><span class="token punctuation">]</span> <span class="token operator">*</span> theil_g<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token string">'result_in: '</span><span class="token punctuation">,</span> result_in<span class="token punctuation">)</span>
  <span class="token keyword">return</span> result_in

<span class="token comment"># ç»„é—´</span>
<span class="token keyword">def</span> <span class="token function">cal_between</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> p<span class="token punctuation">,</span> y<span class="token punctuation">,</span> area_arr<span class="token punctuation">)</span><span class="token punctuation">:</span>
  data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  data<span class="token punctuation">[</span><span class="token string">'åŒºåŸŸ'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'SUM'</span>
  data<span class="token punctuation">[</span><span class="token string">'åŸå¸‚'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'SUM'</span>
  data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">'P'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">/</span> data<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span>
  data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">'Y'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">/</span> data<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span>
  data <span class="token operator">=</span> data<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>labels<span class="token operator">=</span><span class="token string">'SUM'</span><span class="token punctuation">)</span>
  result_between <span class="token operator">=</span>  <span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'P'</span><span class="token punctuation">]</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'P'</span><span class="token punctuation">]</span><span class="token operator">/</span>data<span class="token punctuation">[</span><span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>y <span class="token operator">+</span> <span class="token string">'result_between: '</span><span class="token punctuation">,</span> result_between<span class="token punctuation">)</span>
  <span class="token keyword">return</span> result_between

<span class="token comment"># æŸåŒºåŸŸæ³°å°”æŒ‡æ•°</span>
<span class="token keyword">def</span> <span class="token function">cal_area_theil</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> p<span class="token punctuation">,</span> y<span class="token punctuation">,</span> area_arr<span class="token punctuation">)</span><span class="token punctuation">:</span>
  theil_arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>area_arr<span class="token punctuation">)</span>
  data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  data<span class="token punctuation">[</span><span class="token string">'åŒºåŸŸ'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'SUM'</span>
  data<span class="token punctuation">[</span><span class="token string">'åŸå¸‚'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'SUM'</span>
  data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token string">'P'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">/</span> data<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span>
  data <span class="token operator">=</span> data<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>labels<span class="token operator">=</span><span class="token string">'SUM'</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> idx<span class="token punctuation">,</span> e <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>area_arr<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data_filter <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token string">'åŒºåŸŸ'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è¿‡æ»¤æ•°æ® '</span> <span class="token operator">+</span> e<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data_filter<span class="token punctuation">)</span>
    theil_arr<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> cal_theil<span class="token punctuation">(</span>data_filter<span class="token punctuation">,</span> p<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
  <span class="token keyword">return</span> theil_arr

<span class="token comment"># è®¡ç®—å„åŒºåŸŸäººå£å æ€»äººå£æ¯”ä¾‹</span>
<span class="token keyword">def</span> <span class="token function">cal_area_p</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> p<span class="token punctuation">,</span> area_arr<span class="token punctuation">)</span><span class="token punctuation">:</span>
  p_area <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>area_arr<span class="token punctuation">)</span>
  data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  data<span class="token punctuation">[</span><span class="token string">'åŒºåŸŸ'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'SUM'</span>
  data<span class="token punctuation">[</span><span class="token string">'åŸå¸‚'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'SUM'</span>
  <span class="token keyword">for</span> idx<span class="token punctuation">,</span> e <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>area_arr<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data_filter <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token punctuation">[</span><span class="token string">'åŒºåŸŸ'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>contains<span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è¿‡æ»¤æ•°æ® '</span> <span class="token operator">+</span> e<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data_filter<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    p_area<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> data_filter<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> data<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'SUM'</span><span class="token punctuation">]</span>
  <span class="token keyword">return</span> p_area

<span class="token comment"># è®¡ç®—å„åŒºåŸŸå¹´ä»½æ³°å°”æŒ‡æ•°</span>
<span class="token keyword">def</span> <span class="token function">cal_area_year_theil</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> y<span class="token punctuation">,</span> area_arr<span class="token punctuation">)</span><span class="token punctuation">:</span>
  result_area_year_theil <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>years<span class="token punctuation">)</span>
  <span class="token keyword">for</span> idx<span class="token punctuation">,</span> e <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>years<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'pandas/theil/data/theil_ori_'</span> <span class="token operator">+</span> e <span class="token operator">+</span> <span class="token string">'.csv'</span><span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">&quot;gbk&quot;</span><span class="token punctuation">)</span>
    result_theil_arr <span class="token operator">=</span> cal_area_theil<span class="token punctuation">(</span>data<span class="token punctuation">,</span> p<span class="token punctuation">,</span> y<span class="token punctuation">,</span> area_arr<span class="token punctuation">)</span>
    result_area_year_theil<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> result_theil_arr
  <span class="token keyword">return</span> result_area_year_theil

<span class="token comment"># è®¡ç®—å„åŒºåŸŸå¹´ä»½äººå£/é¢ç§¯æ¯”ä¾‹</span>
<span class="token keyword">def</span> <span class="token function">cal_area_year_p</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> area_arr<span class="token punctuation">)</span><span class="token punctuation">:</span>
  result_area_year_p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>years<span class="token punctuation">)</span>
  <span class="token keyword">for</span> idx<span class="token punctuation">,</span> e <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>years<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'pandas/theil/data/theil_ori_'</span> <span class="token operator">+</span> e <span class="token operator">+</span> <span class="token string">'.csv'</span><span class="token punctuation">,</span> index_col<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">&quot;gbk&quot;</span><span class="token punctuation">)</span>
    result_p_arr <span class="token operator">=</span> cal_area_p<span class="token punctuation">(</span>data<span class="token punctuation">,</span> p<span class="token punctuation">,</span> area_arr<span class="token punctuation">)</span>
    result_area_year_p<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> result_p_arr
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'cal_area_year_pç»“æœ:'</span><span class="token punctuation">,</span> result_area_year_p<span class="token punctuation">)</span>
  <span class="token keyword">return</span> result_area_year_p

<span class="token keyword">def</span> <span class="token function">cal_result_y</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> y<span class="token punctuation">,</span> years<span class="token punctuation">)</span><span class="token punctuation">:</span>
  result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'æ³°å°”æŒ‡æ•°'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'ç»„å†…'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'ç»„é—´'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span>
  result_area_year_theil <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>cal_area_year_theil<span class="token punctuation">(</span>p<span class="token punctuation">,</span> y<span class="token punctuation">,</span> area_arr<span class="token punctuation">)</span><span class="token punctuation">)</span>
  result_area_year_theil<span class="token punctuation">.</span>columns <span class="token operator">=</span> area_arr
  result_area_year_theil<span class="token punctuation">.</span>index <span class="token operator">=</span> years
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è®¡ç®—å„åœ°åŒºtheil\n'</span><span class="token punctuation">,</span> result_area_year_theil<span class="token punctuation">)</span>

  result_area_year_p <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>cal_area_year_p<span class="token punctuation">(</span>p<span class="token punctuation">,</span> area_arr<span class="token punctuation">)</span><span class="token punctuation">)</span>
  result_area_year_p<span class="token punctuation">.</span>columns <span class="token operator">=</span> area_arr
  result_area_year_p<span class="token punctuation">.</span>index <span class="token operator">=</span> years
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è®¡ç®—å„åœ°åŒºPg\n'</span><span class="token punctuation">,</span> result_area_year_p<span class="token punctuation">)</span>

  result_area_year_y <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>cal_area_year_p<span class="token punctuation">(</span>y<span class="token punctuation">,</span> area_arr<span class="token punctuation">)</span><span class="token punctuation">)</span>
  result_area_year_y<span class="token punctuation">.</span>columns <span class="token operator">=</span> area_arr
  result_area_year_y<span class="token punctuation">.</span>index <span class="token operator">=</span> years
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è®¡ç®—å„åœ°åŒºYg\n'</span><span class="token punctuation">,</span> result_area_year_y<span class="token punctuation">)</span>
  <span class="token comment"># ç»„å†…</span>
  result_in <span class="token operator">=</span> <span class="token punctuation">(</span>result_area_year_p <span class="token operator">*</span> result_area_year_theil<span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T
  <span class="token comment"># ç»„é—´</span>
  result_between <span class="token operator">=</span> <span class="token punctuation">(</span>result_area_year_p <span class="token operator">*</span> np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>result_area_year_p <span class="token operator">/</span> result_area_year_y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T

  result<span class="token punctuation">[</span><span class="token string">'æ³°å°”æŒ‡æ•°'</span><span class="token punctuation">]</span> <span class="token operator">=</span> result_area_year_theil
  result<span class="token punctuation">[</span><span class="token string">'ç»„å†…'</span><span class="token punctuation">]</span> <span class="token operator">=</span> result_in
  result<span class="token punctuation">[</span><span class="token string">'ç»„é—´'</span><span class="token punctuation">]</span> <span class="token operator">=</span> result_between
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è®¡ç®—å„åœ°åŒºtheil\n'</span><span class="token punctuation">,</span> result_area_year_theil<span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ç»„å†…æ³°å°”æŒ‡æ•°:\n'</span><span class="token punctuation">,</span> result_in<span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ç»„é—´æ³°å°”æŒ‡æ•°:\n'</span><span class="token punctuation">,</span> result_between<span class="token punctuation">)</span>
  <span class="token keyword">return</span> result
</code></pre></div><p>csvæ–‡ä»¶åæ ¼å¼ä¸ºtheil_ori_<em>[year]</em>.csvï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p> <table><thead><tr><th></th> <th>åŒºåŸŸ</th> <th>åŸå¸‚</th> <th>èµ„æº1</th> <th>èµ„æº2</th> <th>èµ„æºn</th> <th>äººå£</th></tr></thead> <tbody><tr><td>0</td> <td>åŒºåŸŸ1</td> <td>åŸå¸‚1</td> <td>1000</td> <td>100</td> <td>10</td> <td>3000</td></tr> <tr><td>1</td> <td>åŒºåŸŸ1</td> <td>åŸå¸‚2</td> <td>2000</td> <td>200</td> <td>20</td> <td>4000</td></tr> <tr><td>2</td> <td>åŒºåŸŸ2</td> <td>åŸå¸‚3</td> <td>3000</td> <td>300</td> <td>30</td> <td>5000</td></tr></tbody></table> <p>è°ƒç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># main.py</span>
<span class="token keyword">import</span> cal_theil <span class="token keyword">as</span> ct
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> os

result <span class="token operator">=</span> ct<span class="token punctuation">.</span>cal_result_y<span class="token punctuation">(</span><span class="token string">'äººå£'</span><span class="token punctuation">,</span> <span class="token string">'èµ„æº1'</span><span class="token punctuation">,</span> years<span class="token punctuation">)</span>
wrapper1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'èµ„æº1'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'èµ„æº2'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'èµ„æº3'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span>
wrapper2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'èµ„æº1'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'èµ„æº2'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'èµ„æº3'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span>

<span class="token keyword">for</span> idx<span class="token punctuation">,</span> e <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>y_arr<span class="token punctuation">)</span><span class="token punctuation">:</span>
  wrapper1<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">=</span> ct<span class="token punctuation">.</span>cal_result_y<span class="token punctuation">(</span><span class="token string">'äººå£'</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> years<span class="token punctuation">)</span>

<span class="token keyword">for</span> idx<span class="token punctuation">,</span> e <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>y_arr<span class="token punctuation">)</span><span class="token punctuation">:</span>
  wrapper2<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">=</span> ct<span class="token punctuation">.</span>cal_year_theil<span class="token punctuation">(</span><span class="token string">'äººå£'</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> years<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'='</span> <span class="token operator">*</span> <span class="token number">40</span> <span class="token operator">+</span> <span class="token string">&quot; RESULT BEGIN &quot;</span> <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">*</span> <span class="token number">40</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
result_1 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>wrapper1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>wrapper1<span class="token punctuation">)</span><span class="token punctuation">)</span>
result_2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>wrapper2<span class="token punctuation">)</span>
result_2<span class="token punctuation">.</span>index <span class="token operator">=</span> years
<span class="token keyword">print</span><span class="token punctuation">(</span>result_2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'='</span> <span class="token operator">*</span> <span class="token number">40</span> <span class="token operator">+</span> <span class="token string">&quot; RESULT END &quot;</span> <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">*</span> <span class="token number">40</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="header-anchor">#</a> ç›®å½•ç»“æ„</h2> <div class="language- extra-class"><pre class="language-text"><code>.
|____pandas
| |____gini
| | |____cal_gini.py
| | |____main.py
| | |____data
| | | |____gini_ori_2016.csv
| | | |____gini_ori_2017.csv
| | | |____gini_ori_2015.csv
| | | |____gini_ori_2019.csv
| | | |____gini_ori_2018.csv
| | | |____theil_ori_total.csv
| |____theil
| | |____data
| | | |____theil_ori_2015.csv
| | | |____theil_ori_2017.csv
| | | |____theil_ori_2016.csv
| | | |____theil_ori_2018.csv
| | | |____theil_ori_2019.csv
| | |____cal_theil.py
| | |____main.py
</code></pre></div><h2 id="åè®°"><a href="#åè®°" class="header-anchor">#</a> åè®°</h2> <ol><li>Pythonä¸æ„§æ˜¯ä¸“é—¨ç”¨æ¥å†™demoçš„è¯­è¨€(å¤§é›¾)ï¼Œå†™èµ·æ¥æå…¶é¡ºç•…ï¼Œè·Ÿå¹³æ—¶å†™æ–‡ç« çš„æ„Ÿè§‰å·®ä¸å¤šï¼Œä¹Ÿä¸ç”¨å»è€ƒè™‘é‚£äº›ç¹ççš„è¾“å…¥è¾“å‡ºæ ¡éªŒã€‚</li> <li>æ„Ÿè§‰ç»Ÿè®¡å­¦çš„ä¸œè¥¿ä¹Ÿä¸æ˜¯å¾ˆéš¾å˜›ğŸ¤ï¼Œå½“ç„¶é‚£æœ¬ã€Šç»Ÿè®¡å­¦ä¹ æ–¹æ³•ã€‹æˆ‘æ˜¯æ²¡çœ‹æ˜ç™½ã€‚</li> <li>ç½‘ä¸Šæ²¡æ‰¾åˆ°è®¡ç®—æ³°å°”æŒ‡æ•°çš„PythonåŒ…ï¼Œä¸çŸ¥é“æ˜¯æˆ‘æ²¡æ‰¾åˆ°è¿˜æ˜¯ç¡®å®æ²¡æœ‰ï¼Œå› ä¸ºæ¯”è¾ƒèµ¶ï¼Œä¹Ÿæ²¡æ—¶é—´æ‰¾äº†ï¼Œå°±ç›´æ¥è‡ªå·±å®ç°äº†ã€‚</li></ol></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8><li class="copyright-item" data-v-3d9deeb8><a href="https://policies.google.com/privacy?hl=en-US" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8>Privacy Policy</a></li><li class="copyright-item" data-v-3d9deeb8>MIT Licensed | Copyright Â© 2019-present Moxz</li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.d2f1f4ee.js" defer></script><script src="/assets/js/6.86baad8d.js" defer></script><script src="/assets/js/12.d5b0440f.js" defer></script><script src="/assets/js/14.bed357be.js" defer></script>
  </body>
</html>
